Shader "3d/skybox_clear" {
	Properties {
		_uMainTex ("main texture", Cube) = "" {}
        _uRotation ("rotation", Float) = 0.0
	}
	SubShader {
        Blend Off
        Cull Back
        ZTest Less
        ZWrite On
		
		Pass {
            CGPROGRAM
            uniform samplerCUBE _uMainTex;
            uniform float _uRotation;

            struct a2v {
                float4 pos : POSITION;
            };

            struct v2f {
                float4 pos : SV_POSITION;
                float3 tex : TEXCOORD0;
            };

            v2f vert(a2v i) {
                v2f o;
                float alpha = radians(_uRotation);
                float sina = sin(alpha);
                float cosa = cos(alpha);
                float2x2 m = float2x2(
                    float2(cosa, -sina),
                    float2(sina, cosa)
                );
                float3 rotated = float3(mul(m, i.pos.xz), i.pos.y).xzy;
                o.pos = mul(uMVPMatrix, float4(rotated, 1.0));

                o.tex = i.pos.xyz;
                return o;
            }

            float4 frag(v2f i) : SV_TARGET {
                return texCUBE(_uMainTex, i.tex);
            }
            ENDCG
        }
    }
}